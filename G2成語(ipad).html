<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æˆèªéŸ³æ•ˆæŒ‘æˆ°è³½</title>
    <style>
        :root { --p: #ff8e53; --bg: #fff9f2; }
        body { 
            font-family: "Microsoft JhengHei", -apple-system, sans-serif; 
            background: var(--bg); display: flex; flex-direction: column; align-items: center; 
            padding: 20px; margin: 0; -webkit-user-select: none;
        }
        .card { 
            background: white; padding: 25px; border-radius: 20px; 
            box-shadow: 0 8px 20px rgba(255, 142, 83, 0.2); 
            width: 85%; max-width: 400px; margin-bottom: 20px; text-align: center; 
        }
        h1 { color: #d35400; font-size: 1.8rem; margin-bottom: 5px; }
        .btn { 
            width: 100%; padding: 20px; margin: 12px 0; font-size: 1.3rem; font-weight: bold;
            cursor: pointer; border: 2px solid #ffeaa7; border-radius: 15px; background: white;
            display: block; touch-action: manipulation; transition: 0.1s;
        }
        .btn:active { transform: scale(0.95); background: #fff5d1; }
        .btn-blue { color: #0984e3; background: #f0faff; border-color: #74b9ff; }
        .btn-red { color: #d63031; background: #fff5f5; border-color: #ff7675; }
        
        #game-area { display: none; width: 90%; max-width: 450px; background: white; padding: 25px; border-radius: 30px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .q-box { font-size: 3.2rem; letter-spacing: 12px; margin: 25px 0; background: #fdf2e9; padding: 25px; border-radius: 20px; color: #333; }
        .s-box { font-size: 1.6rem; line-height: 1.8; margin-bottom: 25px; text-align: left; padding: 15px; background: #f9f9f9; border-radius: 15px; }
        .blank { color: #ff4757; border-bottom: 5px solid #ff4757; padding: 0 10px; font-weight: bold; }
        .opt-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .opt-btn { 
            padding: 25px 10px; font-size: 1.6rem; border-radius: 20px; font-weight: bold;
            border: 3px solid #f1f2f6; background: white; cursor: pointer; touch-action: manipulation;
        }
        #msg { height: 45px; font-size: 1.6rem; font-weight: bold; margin-bottom: 15px; transition: 0.3s; }
        
        /* å‹•ç•«æ•ˆæœ */
        @keyframes correct-pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); color: #2ecc71; }
            100% { transform: scale(1); }
        }
        .correct-anim { animation: correct-pop 0.5s ease; }
    </style>
</head>
<body>

    <h1>ğŸˆ æˆèªéŸ³æ•ˆç‹ ğŸˆ</h1>
    <p style="color:#e67e22; font-weight:bold;">å°äºŒä¸­æ–‡å¿…å‹ç·´ç¿’</p>
    
    <div id="main-menu">
        <div class="card">
            <h3 style="text-align:left; color:#666; margin-top:0;">ğŸ“ æ¨¡å¼ä¸€ï¼šæ•´å¥å¡«å……</h3>
            <button class="btn btn-blue" onclick="startGame('unit1', 'full')">ğŸ¾ å‹•ç‰©å¤§æœ¬ç‡Ÿ</button>
            <button class="btn btn-blue" onclick="startGame('unit2', 'full')">ğŸ’ª èº«é«”å¾ˆå¥‡å¦™</button>
        </div>
        <div class="card">
            <h3 style="text-align:left; color:#666; margin-top:0;">ğŸ” æ¨¡å¼äºŒï¼šå–®å­—æŒ‘æˆ°</h3>
            <button class="btn btn-red" onclick="startGame('unit1', 'char')">ğŸ¾ å‹•ç‰©å¤§æœ¬ç‡Ÿ</button>
            <button class="btn btn-red" onclick="startGame('unit2', 'char')">ğŸ’ª èº«é«”å¾ˆå¥‡å¦™</button>
        </div>
    </div>

    <div id="game-area">
        <div id="msg"></div>
        <div id="display"></div>
        <div class="opt-grid" id="options"></div>
        <p style="color:#999; margin-top:30px; font-size: 1.1rem;">ğŸŒŸ å·²å®Œæˆï¼š<span id="cur">1</span> / <span id="total">9</span></p>
        <button onclick="location.reload()" style="background:#eee; border:none; border-radius:10px; color:#666; font-size:1rem; padding:10px 20px; margin-top:10px;">è¿”å›ä¸»é¸å–®</button>
    </div>

    <script>
        // éŸ³æ•ˆç”¢ç”Ÿå™¨
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            if (type === 'correct') {
                // å®å’šè² (é«˜éŸ³)
                osc.type = 'sine';
                osc.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
                osc.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1); // A5
                gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.4);
            } else {
                // ç­”éŒ¯è² (ä½éŸ³)
                osc.type = 'square';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.2);
            }
        }

        const data = {
            unit1: [
                { w: "èé›èµ·èˆ", s: "çˆ¸çˆ¸æ¯å¤©æ—©ä¸Š______ï¼Œç·´ç¿’ç¶²çƒæŠ€å·§ã€‚" },
                { w: "èµ°é¦¬çœ‹èŠ±", s: "å“¥å“¥çœ‹æ›¸å¾ˆå¿«ï¼ŒçœŸæ˜¯______ã€‚" },
                { w: "ä¹ç‰›ä¸€æ¯›", s: "é€™ç­†éŒ¢å°å¯Œè±ªä¾†èªªåªæ˜¯______ã€‚" },
                { w: "å¤©é¦¬è¡Œç©º", s: "å¼Ÿå¼Ÿæƒ³åƒåŠ›è±å¯Œï¼Œæ€æƒ³______ã€‚" },
                { w: "é¦¬åˆ°æˆåŠŸ", s: "ç¥ä½ åœ¨æ¯”è³½ä¸­______ï¼Œæ‹¿åˆ°å† è»ï¼" },
                { w: "å¦‚é­šå¾—æ°´", s: "ä»–åœ¨çƒéšŠè£¡è¡¨ç¾å‡ºè‰²ï¼Œç°¡ç›´æ˜¯______ã€‚" },
                { w: "é©šå¼“ä¹‹é³¥", s: "ä»–å—éé©šåš‡ï¼Œç¾åœ¨åƒ______ä¸€æ¨£è†½å°ã€‚" },
                { w: "ç›²äººæ‘¸è±¡", s: "çœ‹äº‹æƒ…è¦å…¨é¢ï¼Œä¸èƒ½åƒ______èˆ¬ç‰‡é¢ã€‚" },
                { w: "é¦¬ä¸åœè¹„", s: "ä»–ä¸‹ç«è»Šå¾Œä¾¿______åœ°è¶•å¾€æœƒå ´ã€‚" }
            ],
            unit2: [
                { w: "åˆ®ç›®ç›¸çœ‹", s: "ä»–çš„é€²æ­¥å¤§å¾—ä»¤äºº______ã€‚" },
                { w: "å‚æ¶ä¸‰å°º", s: "çœ‹è¦‹ç¾å‘³çš„è›‹ç³•ï¼Œå¼Ÿå¼Ÿå¿ä¸ä½______ã€‚" },
                { w: "çœ‰é–‹çœ¼ç¬‘", s: "å¥¶å¥¶é«˜èˆˆå¾—______ã€‚" },
                { w: "é¢ç´…è€³èµ¤", s: "ä»–å€‘åµå¾—______ï¼Œäº’ä¸ç›¸è®“ã€‚" },
                { w: "æ´—è€³æ­è½", s: "æˆ‘æ­£æº–å‚™å¥½______ä½ çš„å»ºè­°ã€‚" },
                { w: "æœ‰ç›®å…±ç¹", s: "ä»–çš„åŠªåŠ›æ˜¯å¤§å®¶______çš„ã€‚" },
                { w: "çœ‰é£›è‰²èˆ", s: "ä»–______åœ°è¬›è¿°è‘—è¶£äº‹ã€‚" },
                { w: "ä»¤äººé«®æŒ‡", s: "é€™ç¨®å£è¡Œç‚ºçœŸæ˜¯______ã€‚" },
                { w: "æ‹¾äººç‰™æ…§", s: "é€™ç¯‡æ–‡ç« æ²’æ–°æ„ï¼Œåªæ˜¯______ã€‚" }
            ]
        };

        let currentList = [];
        let curIdx = 0;
        let gameMode = '';

        function startGame(unit, mode) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            gameMode = mode;
            currentList = [...data[unit]].sort(() => Math.random() - 0.5);
            curIdx = 0;
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('game-area').style.display = 'block';
            renderQuestion();
        }

        function renderQuestion() {
            const item = currentList[curIdx];
            const display = document.getElementById('display');
            const options = document.getElementById('options');
            const msg = document.getElementById('msg');
            
            msg.innerText = "è«‹é¸æ“‡æ­£ç¢ºç­”æ¡ˆï¼š";
            msg.style.color = "#666";
            document.getElementById('cur').innerText = curIdx + 1;
            document.getElementById('total').innerText = currentList.length;
            options.innerHTML = "";

            if (gameMode === 'full') {
                display.innerHTML = `<div class="s-box">${item.s.replace("______", "<span class='blank'>ï¼Ÿ</span>")}</div>`;
                let pool = [item.w];
                while(pool.length < 4) {
                    let r = currentList[Math.floor(Math.random()*currentList.length)].w;
                    if(!pool.includes(r)) pool.push(r);
                }
                drawButtons(pool, item.w);
            } else {
                let charIdx = Math.floor(Math.random() * 4);
                let wordArr = item.w.split('');
                let ans = wordArr[charIdx];
                wordArr[charIdx] = "<span class='blank'>ï¼Ÿ</span>";
                display.innerHTML = `<div class="q-box">${wordArr.join('')}</div>`;
                
                let pool = [ans];
                const decoys = "å¤§å¤©åœ°äººå¿ƒå£æ‰‹è€³ç›®å±±æ°´ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å".split('');
                while(pool.length < 4) {
                    let r = decoys[Math.floor(Math.random()*decoys.length)].trim();
                    if(!pool.includes(r) && !item.w.includes(r)) pool.push(r);
                }
                drawButtons(pool, ans);
            }
        }

        function drawButtons(arr, correct) {
            arr.sort(() => Math.random() - 0.5).forEach(txt => {
                const b = document.createElement('button');
                b.className = 'opt-btn';
                b.innerText = txt;
                b.onclick = function() {
                    if(txt === correct) {
                        playSound('correct');
                        document.getElementById('msg').innerText = "âœ¨ å¤ªæ£’äº†ï¼ç­”å°äº†ï¼ âœ¨";
                        document.getElementById('msg').style.color = "#2ecc71";
                        document.body.classList.add('correct-anim');
                        setTimeout(() => {
                            document.body.classList.remove('correct-anim');
                            curIdx++;
                            if(curIdx < currentList.length) renderQuestion();
                            else { alert("ğŸ‰ æ»¿åˆ†ï¼ä½ æ˜¯æˆèªå°å¤©æ‰ï¼"); location.reload(); }
                        }, 700);
                    } else {
                        playSound('wrong');
                        document.getElementById('msg').innerText = "âŒ å†è©¦ä¸€æ¬¡çœ‹çœ‹ï¼";
                        document.getElementById('msg').style.color = "#e74c3c";
                    }
                };
                document.getElementById('options').appendChild(b);
            });
        }
    </script>
</body>
</html>