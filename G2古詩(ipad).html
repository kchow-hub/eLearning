<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°äºŒå¤è©©æ–‡å¤§æŒ‘æˆ°</title>
    <style>
        :root { --blue: #4A90E2; --green: #48BB78; --red: #F56565; }
        body { font-family: "PingFang TC", sans-serif; background: #F0F4F8; margin: 0; padding: 10px; display: flex; justify-content: center; touch-action: none; overflow: hidden; }
        .container { background: white; padding: 15px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 95vw; max-width: 600px; height: 95vh; display: flex; flex-direction: column; border: 4px solid #BEE3F8; }
        h1 { font-size: 1.4rem; text-align: center; color: #2D3748; margin: 5px 0; }
        .feedback { text-align: center; font-size: 1.5rem; font-weight: bold; height: 2.2rem; margin-bottom: 5px; transition: all 0.2s; }
        #game-box { flex-grow: 1; position: relative; background: #EDF2F7; border-radius: 15px; padding: 5px; overflow: hidden; }
        .line { 
            position: absolute; width: calc(100% - 30px); left: 15px;
            background: white; padding: 15px 5px; border: 2px solid #CBD5E0; 
            border-radius: 12px; font-size: 1.2rem; text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: top 0.2s ease;
            touch-action: none; z-index: 10; user-select: none; font-weight: bold;
        }
        .line.active { z-index: 100; border-color: var(--blue); box-shadow: 0 8px 15px rgba(0,0,0,0.2); transition: none; background: #EBF8FF; }
        .quiz-container { display: flex; flex-direction: column; height: 100%; justify-content: flex-start; padding-top: 10px; }
        .opt { background: white; margin: 6px 0; padding: 14px; border-radius: 12px; font-size: 1.1rem; border: 2px solid #E2E8F0; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .opt.selected { background: #FEEBC8; border-color: #ED8936; }
        .btn { background: var(--blue); color: white; border: none; padding: 16px; border-radius: 50px; font-size: 1.3rem; font-weight: bold; margin-top: 10px; box-shadow: 0 4px 0 #2B6CB0; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="container">
    <h1 id="lvl-title">è®€å–ä¸­...</h1>
    <div id="feedback" class="feedback"></div>
    
    <div id="game-box"></div>

    <button id="main-btn" class="btn" onclick="handleMainClick()">æª¢æŸ¥æ’åº âœ…</button>
</div>

<script>
    // éŸ³æ•ˆæ§åˆ¶ç³»çµ±
    const SFX = {
        ctx: new (window.AudioContext || window.webkitAudioContext)(),
        play(freq, type, duration, ramp = true) {
            const osc = this.ctx.createOscillator();
            const g = this.ctx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
            if(ramp) osc.frequency.exponentialRampToValueAtTime(freq/2, this.ctx.currentTime + duration);
            g.gain.setValueAtTime(0.1, this.ctx.currentTime);
            g.gain.linearRampToValueAtTime(0, this.ctx.currentTime + duration);
            osc.connect(g); g.connect(this.ctx.destination);
            osc.start(); osc.stop(this.ctx.currentTime + duration);
        },
        correct() { this.play(523, 'sine', 0.3, false); setTimeout(()=>this.play(880, 'sine', 0.4, false), 100); },
        wrong() { this.play(150, 'sawtooth', 0.5); },
        win() { [523, 659, 784, 1046].forEach((f, i) => setTimeout(() => this.play(f, 'sine', 0.5, false), i * 150)); }
    };

    const data = [
        {
            title: "ã€Šèœ‚ã€‹ç¾…éš±",
            lines: ["ä¸è«–å¹³åœ°èˆ‡å±±å°–ï¼Œ", "ç„¡é™é¢¨å…‰ç›¡è¢«ä½”ã€‚", "æ¡å¾—ç™¾èŠ±æˆèœœå¾Œï¼Œ", "ç‚ºèª°è¾›è‹¦ç‚ºèª°ç”œï¼"],
            qs: [
                { q: "ç¬¬ä¸€ã€äºŒå¥ä¸»è¦å¯«äº†ä»€éº¼ï¼Ÿ", opts: ["A. éƒŠå¤–ç¾éº—çš„é¢¨å…‰", "B. èœ‚èœœçš„é¦™ç”œ", "C. èœœèœ‚æ¡èœœçš„å ´æ™¯", "D. è©©äººå°èœœèœ‚çš„è®šç¾"], ans: 0 },
                { q: "ã€Œç”œã€å‘¼æ‡‰ç¬¬ä¸‰å¥ä¸­çš„å“ªå€‹è©ï¼Ÿ", opts: ["ç™¾èŠ±", "èœœ", "æ¡", "å¾Œ"], ans: 1 },
                { q: "è©©ä¸­è®šç¾èœœèœ‚ä»€éº¼ç²¾ç¥ï¼Ÿ(é¸äºŒ)", opts: ["è¾›å‹¤å‹å‹•", "å¿—å‘é å¤§", "é¡§å…¨å¤§å±€", "é»˜é»˜å¥‰ç»", "è¿é›£è€Œä¸Š"], ans: [0, 3], multi: true }
            ]
        },
        {
            title: "ã€Šå®ˆæ ªå¾…å…”ã€‹éŸ“éå­",
            lines: ["å®‹äººæœ‰è€•è€…ï¼Œç”°ä¸­æœ‰æ ªï¼Œ", "å…”èµ°è§¸æ ªï¼ŒæŠ˜é ¸è€Œæ­»ï¼Œ", "å› é‡‹å…¶è€’è€Œå®ˆæ ªï¼Œå†€å¾©å¾—å…”ï¼Œ", "å…”ä¸å¯å¾©å¾—ï¼Œè€Œèº«ç‚ºå®‹åœ‹ç¬‘ã€‚"],
            qs: [
                { q: "æ–‡ä¸­å“ªä¸€å€‹è©èˆ‡ã€Œè¾²å¤«ã€æ„æ€ç›¸åŒï¼Ÿ", opts: ["è€•è€…", "å®‹äºº", "å…¶", "æ ª"], ans: 0 },
                { q: "ã€Œå¾©å¾—ã€çš„æ„æ€æ˜¯ä»€éº¼ï¼Ÿ", opts: ["å¤±å»äº†", "æœ€å¾Œå¾—åˆ°", "å†ä¸€æ¬¡å¾—åˆ°"], ans: 2 },
                { q: "è¾²å¤«æ’¿åˆ°å…”å­å¾Œï¼Œä»–æ€æ¨£åšï¼Ÿ", opts: ["A. åœ¨å‘¨åœè¨­ç½®é™·é˜±", "B. ä¸å†è€•ç¨®ï¼Œç­‰å¾…å…”å­æ’æ­»"], ans: 1 },
                { q: "å“ªä¸€é …æè¿°æ˜¯æ­£ç¢ºçš„ï¼Ÿ", opts: ["A. è¾²å¤«æ„å¤–æ’¿åˆ°å…”å­", "B. è¾²å¤«æŠŠç”°åœ°éƒ½è³£äº†"], ans: 0 }
            ]
        },
        {
            title: "ã€Šç•«é›ã€‹å”å¯…",
            lines: ["é ­ä¸Šç´…å† ä¸ç”¨è£ï¼Œ", "æ»¿èº«é›ªç™½èµ°å°‡ä¾†ã€‚", "å¹³ç”Ÿä¸æ•¢è¼•è¨€èªï¼Œ", "ä¸€å«åƒé–€è¬æˆ¶é–‹ã€‚"],
            qs: [
                { q: "å…¬é›èµ°è·¯çš„æ¨£å­æ˜¯ï¼Ÿ", opts: ["A. å¿«å¦‚é–ƒé›»", "B. ç²¾ç¥æŠ–æ“»", "C. è·Œè·Œæ’æ’"], ans: 1 },
                { q: "åˆ¤æ–·ï¼šå…¬é›å¹³æ—¥ç¶“å¸¸å•¼å«å—ï¼Ÿ", opts: ["æ­£ç¢º", "éŒ¯èª¤"], ans: 1 },
                { q: "å…¬é›å•¼å«æ™‚è²éŸ³éŸ¿äº®å—ï¼Ÿ", opts: ["æ­£ç¢º", "éŒ¯èª¤"], ans: 0 },
                { q: "å“ªäº›æ€§æ ¼å€¼å¾—è¡¨æšï¼Ÿ(é¸äºŒ)", opts: ["å…¬å¹³", "å‹‡æ•¢", "è² è²¬ä»»", "æœ‰æ©å¿…å ±", "å …å®ˆå´—ä½"], ans: [2, 4], multi: true }
            ]
        }
    ];

    let curLvl = 0, curQ = 0, isQuiz = false, elements = [], selectedMulti = [];

    function init() {
        isQuiz = false; curQ = 0;
        document.getElementById('lvl-title').innerText = data[curLvl].title;
        document.getElementById('main-btn').innerText = "æª¢æŸ¥æ’åº âœ…";
        document.getElementById('main-btn').style.opacity = "1";
        const gameBox = document.getElementById('game-box');
        gameBox.innerHTML = ""; elements = [];
        
        let shuffled = [...data[curLvl].lines].sort(() => Math.random() - 0.5);
        shuffled.forEach((txt, i) => {
            const el = document.createElement('div');
            el.className = 'line';
            el.innerText = txt;
            el.style.top = (i * 75 + 15) + "px";
            el.addEventListener('touchstart', touchStart, {passive: false});
            el.addEventListener('touchmove', touchMove, {passive: false});
            el.addEventListener('touchend', touchEnd);
            gameBox.appendChild(el);
            elements.push(el);
        });
    }

    let startY, startTop, active = null;
    function touchStart(e) { 
        SFX.ctx.resume(); // å•Ÿç”¨ iPad éŸ³é »
        active = e.target; active.classList.add('active');
        startY = e.touches[0].pageY; startTop = parseInt(active.style.top);
    }
    function touchMove(e) {
        if(!active) return; e.preventDefault();
        let moveY = e.touches[0].pageY - startY;
        active.style.top = Math.max(5, Math.min(startTop + moveY, document.getElementById('game-box').offsetHeight - 60)) + "px";
        elements.sort((a,b) => parseInt(a.style.top) - parseInt(b.style.top)).forEach((el, i) => {
            if(el !== active) el.style.top = (i * 75 + 15) + "px";
        });
    }
    function touchEnd() { 
        if(!active) return; active.classList.remove('active');
        elements.sort((a,b) => parseInt(a.style.top) - parseInt(b.style.top)).forEach((el, i) => {
            el.style.top = (i * 75 + 15) + "px";
        });
        active = null; 
    }

    function handleMainClick() {
        if(!isQuiz) {
            const current = elements.sort((a,b) => parseInt(a.style.top) - parseInt(b.style.top)).map(el => el.innerText);
            if(JSON.stringify(current) === JSON.stringify(data[curLvl].lines)) {
                SFX.correct(); showMsg("âœ… æ’åºæ­£ç¢ºï¼", "var(--green)");
                setTimeout(startQuiz, 800);
            } else { SFX.wrong(); showMsg("âŒ é †åºä¸å°å–”", "var(--red)"); }
        } else { checkMultiFinal(); }
    }

    function startQuiz() {
        isQuiz = true; document.getElementById('game-box').innerHTML = "";
        showQuestion();
    }

    function showQuestion() {
        const qData = data[curLvl].qs[curQ];
        document.getElementById('main-btn').innerText = qData.multi ? "ç¢ºèªå¤šé¸ç­”æ¡ˆ" : "é»é¸æ­£ç¢ºç­”æ¡ˆ";
        document.getElementById('main-btn').style.opacity = qData.multi ? "1" : "0.5";
        document.getElementById('game-box').innerHTML = `<div class="quiz-container"><p style="font-weight:bold; font-size:1.15rem; margin: 5px 10px;">${qData.q}</p><div id="opts" style="padding: 0 10px;"></div></div>`;
        selectedMulti = [];
        qData.opts.forEach((o, i) => {
            const d = document.createElement('div'); d.className = 'opt'; d.innerText = o;
            d.onclick = () => { SFX.ctx.resume(); qData.multi ? toggleM(i, d) : checkS(i); };
            document.getElementById('opts').appendChild(d);
        });
    }

    function checkS(i) {
        if(i === data[curLvl].qs[curQ].ans) { SFX.correct(); showMsg("ğŸŒŸ ç­”å°äº†ï¼", "var(--green)"); next(); }
        else { SFX.wrong(); showMsg("âŒ å†è©¦ä¸€æ¬¡", "var(--red)"); }
    }

    function toggleM(i, el) {
        if(selectedMulti.includes(i)) { selectedMulti = selectedMulti.filter(x => x !== i); el.classList.remove('selected'); }
        else { selectedMulti.push(i); el.classList.add('selected'); }
    }

    function checkMultiFinal() {
        if(!data[curLvl].qs[curQ].multi) return;
        const correct = data[curLvl].qs[curQ].ans.sort();
        if(JSON.stringify(selectedMulti.sort()) === JSON.stringify(correct)) { SFX.correct(); showMsg("ğŸŒŸ ç­”å°äº†ï¼", "var(--green)"); next(); }
        else { SFX.wrong(); showMsg("âŒ é¸é …ä¸å®Œå…¨å°", "var(--red)"); }
    }

    function next() {
        curQ++;
        setTimeout(() => {
            if(curQ < data[curLvl].qs.length) showQuestion();
            else { curLvl++; if(curLvl < data.length) init(); else win(); }
        }, 800);
    }

    function showMsg(m, c) { const f = document.getElementById('feedback'); f.innerText = m; f.style.color = c; }
    function win() { SFX.win(); document.body.innerHTML = "<div style='text-align:center; margin-top:30vh; width:100%'><h1>ğŸ† æŒ‘æˆ°æˆåŠŸï¼</h1><p>å°æœ‹å‹å¥½æ£’ï¼Œå¦³å·²ç¶“å®Œå…¨è¤‡ç¿’å¥½äº†ï¼</p><button class='btn' onclick='location.reload()'>å†ç©ä¸€æ¬¡</button></div>"; }

    window.onload = init;
</script>
</body>
</html>