<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>G2 è–ç¶“ç§‘å…¨æ–¹ä½è¤‡ç¿’</title>
    <style>
        :root { --primary: #6c5ce7; --secondary: #a29bfe; --correct: #00b894; --wrong: #d63031; --bg: #f8f9fa; }
        body { font-family: "PingFang HK", "Microsoft JhengHei", sans-serif; background-color: var(--bg); margin: 0; display: flex; justify-content: center; touch-action: manipulation; }
        #game-container { width: 100%; max-width: 600px; background: white; min-height: 100vh; padding: 20px; box-sizing: border-box; display: flex; flex-direction: column; box-shadow: 0 0 15px rgba(0,0,0,0.1); }
        .header { text-align: center; border-bottom: 3px solid var(--primary); margin-bottom: 10px; padding-bottom: 5px; }
        .progress-info { text-align: center; font-size: 14px; color: #666; margin-bottom: 5px; font-weight: bold; }
        .progress-bar { width: 100%; height: 12px; background: #eee; border-radius: 6px; margin-bottom: 20px; overflow: hidden; }
        #progress-fill { height: 100%; background: var(--primary); width: 0%; transition: 0.4s; }
        .question-header { display: flex; align-items: flex-start; gap: 12px; margin-bottom: 15px; }
        .tts-btn { background: var(--secondary); border: none; border-radius: 50%; width: 44px; height: 44px; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 20px; box-shadow: 0 4px #5649c0; }
        .question-text { font-size: 20px; font-weight: bold; line-height: 1.5; color: #2d3436; }
        mark { background-color: yellow; font-weight: bold; padding: 0 2px; border-radius: 2px; }
        .option-btn { display: block; width: 100%; padding: 16px; margin: 10px 0; border: 2px solid #e0e0e0; border-radius: 12px; background: white; font-size: 18px; text-align: left; cursor: pointer; -webkit-tap-highlight-color: transparent; }
        .selected-container { min-height: 70px; padding: 12px; border: 2px dashed var(--primary); border-radius: 10px; margin-bottom: 10px; background: #fdfbff; display: flex; flex-direction: column; gap: 8px; }
        .sort-tag { background: var(--primary); color: white; padding: 10px 16px; border-radius: 8px; font-size: 15px; cursor: pointer; }
        .sort-tag::before { content: attr(data-index) ". "; font-weight: bold; }
        .feedback-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.92); display: none; z-index: 100; justify-content: center; align-items: center; padding: 25px; }
        .feedback-card { background: white; width: 100%; max-width: 420px; border-radius: 24px; padding: 30px; text-align: center; }
        .ans-text { color: var(--wrong); font-weight: bold; margin-top: 15px; font-size: 16px; text-align: left; white-space: pre-wrap; }
        .next-btn { margin-top: 20px; background: var(--primary); color: white; border: none; padding: 16px; border-radius: 14px; font-size: 20px; cursor: pointer; width: 100%; font-weight: bold; }
    </style>
</head>
<body onclick="unlockAudio()">

<div id="game-container">
    <div class="header"><h2>è–ç¶“ç§‘æ¸¬é©—è¤‡ç¿’ (23é¡Œå…¨ç‰ˆ)</h2></div>
    <div class="progress-info" id="progress-text">æº–å‚™é–‹å§‹...</div>
    <div class="progress-bar"><div id="progress-fill"></div></div>
    <div id="quiz-content"></div>
    <div class="footer" style="margin-top:auto; text-align:center;"><div id="score-display" style="font-weight:bold; color:var(--primary); font-size:22px;">åˆ†æ•¸: 0</div></div>
</div>

<div id="feedback-overlay" class="feedback-overlay">
    <div class="feedback-card">
        <div id="feedback-emoji" style="font-size: 60px;"></div>
        <div id="feedback-msg" style="font-size: 24px; font-weight: bold;"></div>
        <div id="correct-ans-area" class="ans-text"></div>
        <button class="next-btn" onclick="nextQuestion()">ç¹¼çºŒ</button>
    </div>
</div>

<script>
    const allQuestions = [
        // å·æ•¸èˆ‡æ–‡å­— (5é¡Œ)
        { type: 'mc', q: 'å…¨æœ¬è–ç¶“å…±å¤šå°‘å·æ›¸ï¼Ÿ', options: ['39å·', '27å·', '66å·'], correctText: '66å·' },
        { type: 'mc', q: '<mark>èˆŠç´„</mark>æ›¸å·æ•¸ç›®æ˜¯å¤šå°‘ï¼Ÿ', options: ['27', '39', '66'], correctText: '39' },
        { type: 'mc', q: '<mark>æ–°ç´„</mark>æ›¸å·æ•¸ç›®æ˜¯å¤šå°‘ï¼Ÿ', options: ['39', '66', '27'], correctText: '27' },
        { type: 'mc', q: '<mark>èˆŠç´„</mark>å¯«æˆæ–‡å­—æ˜¯ä»€éº¼ï¼Ÿ', options: ['å¸Œè‡˜æ–‡', 'å¸Œä¼¯ä¾†æ–‡', 'è‹±æ–‡'], correctText: 'å¸Œä¼¯ä¾†æ–‡' },
        { type: 'mc', q: '<mark>æ–°ç´„</mark>å¯«æˆæ–‡å­—æ˜¯ä»€éº¼ï¼Ÿ', options: ['å¸Œä¼¯ä¾†æ–‡', 'å¸Œè‡˜æ–‡', 'ä¸­æ–‡'], correctText: 'å¸Œè‡˜æ–‡' },
        
        // å·´åˆ¥å¡”æ’åº (1é¡Œ)
        { 
            type: 'sort', q: 'æ’åºï¼šå·´åˆ¥å¡”çš„äº‹ä»¶ç¶“é', 
            parts: [{id:'1', t:'å¤©ä¸‹çš„äººçš„èªè¨€éƒ½æ˜¯ä¸€æ¨£çš„ï¼Œä»–å€‘æœ‰æƒ³å»ºåŸå’Œå¡”çš„æƒ³æ³•ã€‚'}, {id:'2', t:'äººå€‘ä¸€èµ·å»ºç¯‰é«˜å¡”ï¼Œè¦é«˜èˆ‰è‡ªå·±çš„åã€‚'}, {id:'3', t:'ç¥è®Šäº‚äººçš„å£éŸ³ã€‚'}, {id:'4', t:'å·´åˆ¥å¡”ä¸èƒ½å®Œå·¥ï¼Œäººå€‘åˆ†æ•£åœ¨å…¨åœ°ä¸Šã€‚'}],
            correctOrder: '1234'
        },

        // é‡‘å¥æ’åº (4é¡Œ)
        { type: 'sort', q: 'é‡‘å¥ï¼šç´„ç¿°ç¦éŸ³ 3:16', parts: [{id:'A', t:'ç¥æ„›ä¸–äºº,ç”šè‡³å°‡ä»–'}, {id:'D', t:'ç¨ä¸€çš„å…’å­è³œçµ¦ä»–å€‘,'}, {id:'C', t:'å«ä¸€åˆ‡ä¿¡ä»–çš„äºº'}, {id:'B', t:'ä¸è‡´æ»…äº¡,åå¾—æ°¸ç”Ÿã€‚'}], correctOrder: 'ADCB' },
        { type: 'sort', q: 'é‡‘å¥ï¼šè·¯åŠ ç¦éŸ³ 21:33', parts: [{id:'B', t:'å¤©åœ°'}, {id:'A', t:'è¦å»¢å»,'}, {id:'C', t:'æˆ‘çš„è©±'}, {id:'D', t:'å»çµ•ä¸å»¢å»ã€‚'}], correctOrder: 'BACD' },
        { type: 'sort', q: 'é‡‘å¥ï¼šè©©ç¯‡ 1:2 ä¸‹', parts: [{id:'D', t:'æƒŸå–œæ„›è€¶å’Œè¯çš„å¾‹æ³•,'}, {id:'C', t:'æ™å¤œæ€æƒ³'}, {id:'A', t:'ç¥‚çš„å¾‹æ³•;'}, {id:'B', t:'é€™äººä¾¿ç‚ºæœ‰ç¦!'}], correctOrder: 'DCAB' },
        { type: 'sort', q: 'é‡‘å¥ï¼šé›…å„æ›¸ 4:6 ä¸‹', parts: [{id:'B', t:'ç¥æŠµæ“‹'}, {id:'D', t:'é©•å‚²çš„äºº,'}, {id:'A', t:'ä½†è³œæ©'}, {id:'C', t:'çµ¦è¬™å‘çš„äººã€‚'}], correctOrder: 'BDAC' },

        // é¸æ“‡é¡Œ (5é¡Œ)
        { type: 'mc', q: 'è–ç¶“å¤§æ¦‚ç”¨äº†å¤šå°‘å¹´æ‰å¯«æˆï¼Ÿ', options: ['10å¹´', '500å¹´', '1600å¹´'], correctText: '1600å¹´' },
        { type: 'mc', q: 'ã€Œå·´åˆ¥ã€çš„æ„æ€æ˜¯ï¼š', options: ['è®Šäº‚', 'å‰µé€ ', 'è¬™å‘'], correctText: 'è®Šäº‚' },
        { type: 'mc', q: 'ç¥æ€æ¨£é˜»æ­¢äººå€‘èˆˆå»ºå·´åˆ¥å¡”ï¼Ÿ', options: ['è¦ªæ‰‹æ‹†æ‰', 'è®Šäº‚äººçš„èªè¨€', 'é™ä¸‹çƒˆç«'], correctText: 'è®Šäº‚äººçš„èªè¨€' },
        { type: 'mc', q: 'è€¶ç©Œåœ¨æ­»å¾Œç¬¬å¹¾å¤©å¾©æ´»ï¼Ÿ', options: ['ç¬¬ä¸€å¤©', 'ç¬¬ä¸‰å¤©', 'ç¬¬å…­å¤©'], correctText: 'ç¬¬ä¸‰å¤©' },
        { type: 'mc', q: 'å…¨æœ¬è–ç¶“çš„ä¸»æ—¨æ˜¯ç¥çš„____ã€‚', options: ['ç½ª', 'è€¶ç©Œ', 'æ•‘æ©'], correctText: 'æ•‘æ©' },

        // æ˜¯éé¡Œ (4é¡Œ)
        { type: 'mc', q: 'æ˜¯éé¡Œï¼šé€™ä¸–ç•Œæœ‰ä¸€ä½çœŸç¥ï¼Œç¥‚å‰µé€ å¤©åœ°åˆå‰µé€ äººé¡ã€‚', options: ['âˆš å°', 'X éŒ¯'], correctText: 'âˆš å°' },
        { type: 'mc', q: 'æ˜¯éé¡Œï¼šå¾å·´åˆ¥å¡”çš„æ•…äº‹ï¼Œæˆ‘å€‘çŸ¥é“ç¥å–œæ„›äººé©•å‚²ã€‚', options: ['âˆš å°', 'X éŒ¯'], correctText: 'X éŒ¯' },
        { type: 'mc', q: 'æ˜¯éé¡Œï¼š<mark>èˆŠç´„</mark>æ˜¯ä»¥ä¸­æ–‡å¯«æˆï¼Œè€Œ<mark>æ–°ç´„</mark>ä»¥è‹±æ–‡å¯«æˆã€‚', options: ['âˆš å°', 'X éŒ¯'], correctText: 'X éŒ¯' },
        { type: 'mc', q: 'æ˜¯éé¡Œï¼šå‡¡ç›¸ä¿¡è€¶ç©ŒåŸºç£çš„äººï¼Œéƒ½èƒ½æˆç‚ºç¥‚çš„å…’å¥³ã€‚', options: ['âˆš å°', 'X éŒ¯'], correctText: 'âˆš å°' },

        // å¡«å……é¡Œ (4é¡Œ)
        { type: 'mc', q: 'æˆ‘å€‘____ç¥çš„è©±ï¼Œå°±å¿…å¾—è‘—ç¥ç¦ã€‚', options: ['éµå®ˆ', 'æ•¬ç•', 'æ•‘æ©'], correctText: 'éµå®ˆ' },
        { type: 'mc', q: 'äººè¦å°ç¥å­˜____çš„å¿ƒï¼Œä¸æ‡‰æƒ³åƒè‡ªå·±è·Ÿç¥æœ‰åŒæ¨£çš„åœ°ä½ã€‚', options: ['è€¶ç©Œ', 'æ•¬ç•', 'éµå®ˆ'], correctText: 'æ•¬ç•' },
        { type: 'mc', q: 'ç¥æ‡‰è¨±è—‰____åŸºç£æ‹¯æ•‘åŠè³œç¦äºˆæˆ‘å€‘ã€‚', options: ['éµå®ˆ', 'è€¶ç©Œ', 'æ•‘æ©'], correctText: 'è€¶ç©Œ' },
        { type: 'mc', q: 'ç”±æ–¼ä¸–äººéƒ½çŠ¯äº†____ï¼Œçµæœèˆ‡æˆ‘å€‘çš„ç¥éš”é–‹äº†ã€‚', options: ['æ•‘æ©', 'éµå®ˆ', 'ç½ª'], correctText: 'ç½ª' }
    ];

    let currentIdx = 0, score = 0, selectedIds = [], audioCtx = null, randomizedQuestions = [];

    function shuffle(array) { return array.sort(() => Math.random() - 0.5); }

    function unlockAudio() {
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const b = audioCtx.createBuffer(1, 1, 22050);
            const s = audioCtx.createBufferSource(); s.buffer = b; s.connect(audioCtx.destination); s.start(0);
        }
        if (audioCtx.state === 'suspended') audioCtx.resume();
    }

    function playSfx(win) {
        if (!audioCtx) return;
        const o = audioCtx.createOscillator(), g = audioCtx.createGain();
        o.connect(g); g.connect(audioCtx.destination);
        o.frequency.setValueAtTime(win ? 523 : 150, audioCtx.currentTime);
        if(win) o.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1);
        g.gain.setValueAtTime(0.1, audioCtx.currentTime); o.start(); o.stop(audioCtx.currentTime + 0.3);
    }

    function render() {
        const q = randomizedQuestions[currentIdx];
        const container = document.getElementById('quiz-content');
        const total = randomizedQuestions.length;
        document.getElementById('progress-text').innerText = `é¡Œç›®ï¼š${currentIdx + 1} / ${total} (é¤˜ä¸‹ ${total - (currentIdx + 1)} é¡Œ)`;
        document.getElementById('progress-fill').style.width = `${((currentIdx + 1) / total) * 100}%`;
        
        let h = `<div class="question-header"><button class="tts-btn" onclick="speakQuestion()">ğŸ”Š</button><div class="question-text">${q.q}</div></div>`;
        
        if (q.type === 'mc') {
            const shuffledOptions = shuffle([...q.options]);
            shuffledOptions.forEach(opt => h += `<button class="option-btn" onclick="checkMC('${opt}')">${opt}</button>`);
        } else {
            h += `<div class="hint" style="font-size:14px; color:#666; margin-bottom:10px;">è«‹æŒ‰é †åºé»æ“Š (é»æ“Šæ¨™ç±¤å¯æ’¤å›)ï¼š</div><div class="selected-container" id="box"></div>`;
            shuffle([...q.parts]).forEach(p => h += `<button class="option-btn" id="btn-${p.id}" onclick="pick('${p.id}','${p.t}')">${p.t}</button>`);
            selectedIds = [];
        }
        container.innerHTML = h;
    }

    window.pick = (id, t) => {
        const btn = document.getElementById(`btn-${id}`); if(btn.disabled) return;
        btn.disabled = true; selectedIds.push(id);
        const tag = document.createElement('div'); tag.className = 'sort-tag'; tag.id = `tag-${id}`; tag.innerText = t;
        tag.setAttribute('data-index', selectedIds.length); tag.onclick = () => unpick(id);
        document.getElementById('box').appendChild(tag);
        if(selectedIds.length === randomizedQuestions[currentIdx].parts.length) {
            setTimeout(() => showResult(selectedIds.join('') === randomizedQuestions[currentIdx].correctOrder), 200);
        }
    };

    window.unpick = (id) => {
        selectedIds = selectedIds.filter(x => x !== id);
        document.getElementById(`btn-${id}`).disabled = false;
        document.getElementById(`tag-${id}`).remove();
        document.querySelectorAll('.sort-tag').forEach((t, i) => t.setAttribute('data-index', i + 1));
    };

    window.checkMC = (val) => showResult(val === randomizedQuestions[currentIdx].correctText);

    function showResult(win) {
        unlockAudio(); playSfx(win);
        const q = randomizedQuestions[currentIdx];
        document.getElementById('feedback-overlay').style.display = 'flex';
        document.getElementById('feedback-emoji').innerText = win ? 'ğŸŒŸ' : 'ğŸ“–';
        document.getElementById('feedback-msg').innerText = win ? 'ç­”å°äº†ï¼' : 'å†è©¦è©¦çœ‹ï¼';
        document.getElementById('feedback-msg').style.color = win ? 'var(--correct)' : 'var(--wrong)';
        let correctStr = q.type === 'mc' ? q.correctText : q.parts.sort((a,b) => q.correctOrder.indexOf(a.id) - q.correctOrder.indexOf(b.id)).map((p,i)=>(i+1)+'. '+p.t).join('\n');
        document.getElementById('correct-ans-area').innerHTML = win ? "" : `æ­£ç¢ºç­”æ¡ˆï¼š<br>${correctStr}`;
        if(win) score += 5;
        document.getElementById('score-display').innerText = `åˆ†æ•¸: ${score}`;
    }

    window.nextQuestion = () => {
        document.getElementById('feedback-overlay').style.display = 'none';
        if(++currentIdx < randomizedQuestions.length) render(); else finish();
    };

    function speakQuestion() {
        const text = randomizedQuestions[currentIdx].q.replace(/<[^>]*>/g, '');
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'zh-HK'; window.speechSynthesis.speak(msg);
    }

    function finish() {
        document.getElementById('quiz-content').innerHTML = `<div style="text-align:center; padding:40px;"><h2>ğŸ† æ­å–œå®Œæˆ 23 é¡Œè¤‡ç¿’ï¼</h2><p>æœ€çµ‚å¾—åˆ†: ${score}</p><button class="next-btn" onclick="location.reload()">é‡æ–°é–‹å§‹</button></div>`;
    }

    randomizedQuestions = shuffle([...allQuestions]);
    render();
</script>
</body>
</html>