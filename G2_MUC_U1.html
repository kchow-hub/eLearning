<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>G2éŸ³å‰µ_Unit 1</title>
    <style>
        :root { --primary: #FF9800; --secondary: #2196F3; --success: #4CAF50; --error: #F44336; --bg: #FFF3E0; 
                --s1: #9C27B0; --s2: #E91E63; --s3: #673AB7; --s4: #3F51B5; --s5: #009688; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; align-items: center; touch-action: manipulation; -webkit-user-select: none; }
        #game-container { width: 95%; max-width: 600px; background: white; border-radius: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); margin: 15px 0; padding: 20px; text-align: center; border: 5px solid var(--primary); position: relative; min-height: 580px; box-sizing: border-box; }
        .header { font-size: 22px; color: #E65100; margin-bottom: 5px; font-weight: bold; }
        .score-board { font-size: 15px; color: #555; margin-bottom: 10px; background: #FFFDE7; padding: 5px; border-radius: 10px; }
        .question-box { background: #FAFAFA; border-radius: 20px; padding: 15px; min-height: 250px; margin-bottom: 15px; display: flex; flex-direction: column; justify-content: center; align-items: center; border: 2px dashed #ccc; }
        
        /* äº”ç·šè­œç¹ªè£½ */
        .staff-container { width: 280px; height: 120px; position: relative; margin: 25px auto; border-left: 2px solid #333; border-right: 2px solid #333; background: white; }
        .staff-line { position: absolute; width: 100%; height: 2px; background: #333; left: 0; }
        .line5 { top: 20px; } .line4 { top: 40px; } .line3 { top: 60px; } .line2 { top: 80px; } .line1 { top: 100px; }
        .clef { position: absolute; left: 8px; font-family: "serif"; line-height: 1; z-index: 1; color: #333; pointer-events: none; }
        .treble-clef { top: 5px; font-size: 85px; }
        .bass-clef { top: 18px; font-size: 65px; }
        .staff-note { position: absolute; width: 26px; height: 20px; background: black; border-radius: 50%; transform: rotate(-15deg); left: 60%; margin-left: -13px; z-index: 10; }
        .ledger-line { position: absolute; width: 40px; height: 2px; background: #333; left: 60%; margin-left: -20px; z-index: 5; }

        .note-display { font-size: 100px; line-height: 1; margin: 10px; font-family: "serif"; color: #333; }
        .math-symbol-box { font-size: 50px; color: #D84315; margin: 10px; font-weight: bold; }

        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 100%; }
        button { background: var(--secondary); border: none; border-radius: 12px; padding: 18px 5px; color: white; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 0 #1565C0; -webkit-tap-highlight-color: transparent; }
        button:active { transform: translateY(3px); box-shadow: none; }
        button:disabled { background: #ccc !important; box-shadow: none !important; }
        
        #feedback { margin-top: 10px; font-weight: bold; font-size: 20px; height: 30px; }
        .progress-bar { width: 100%; height: 12px; background: #eee; border-radius: 10px; margin-bottom: 10px; overflow: hidden; }
        #progress { width: 0%; height: 100%; background: var(--success); transition: width 0.3s; }

        #menu-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 20; display: flex; flex-direction: column; align-items: center; padding: 15px; box-sizing: border-box; overflow-y: auto; }
        .menu-btn { width: 100%; max-width: 450px; margin: 6px 0; padding: 12px; font-size: 14px; border: none; border-radius: 12px; color: white; cursor: pointer; text-align: left; }
        .menu-btn b { font-size: 16px; display: block; }
        .tag-exam { float: right; background: #FF5252; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; }
        .tag-non { float: right; background: #757575; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="menu-overlay">
        <h2 style="color: #E65100; margin: 10px 0;">ğŸ¶ éŸ³æ¨‚è€ƒè©¦å…¨èƒ½æŒ‘æˆ°</h2>
        <button class="menu-btn" style="background:var(--s1);" onclick="startSection(1)">
            <span class="tag-exam">EXAM</span><b>SECTION 1: éŸ³ç¬¦èˆ‡ç¯€å¥ (24é¡Œ)</b><small>åç¨±ã€æ™‚å€¼ã€Kodalyã€é™„é»èˆ‡é€£çµç·š</small>
        </button>
        <button class="menu-btn" style="background:var(--s2);" onclick="startSection(2)">
            <span class="tag-exam">EXAM</span><b>SECTION 2: é«˜éŸ³è­œè¡¨ (C4-G4)</b><small>Middle C è‡³ Sol çš„ä½ç½®è¾¨èª</small>
        </button>
        <button class="menu-btn" style="background:var(--s3);" onclick="startSection(3)">
            <span class="tag-non">NON-EXAM</span><b>SECTION 3: é«˜éŸ³è­œè¡¨ (C4-C5)</b><small>Middle C è‡³ é«˜éŸ³ Do</small>
        </button>
        <button class="menu-btn" style="background:var(--s4);" onclick="startSection(4)">
            <span class="tag-exam">EXAM</span><b>SECTION 4: ä½éŸ³è­œè¡¨ (F3-C4)</b><small>ä½éŸ³ Fa è‡³ Middle C</small>
        </button>
        <button class="menu-btn" style="background:var(--s5);" onclick="startSection(5)">
            <span class="tag-non">NON-EXAM</span><b>SECTION 5: ä½éŸ³è­œè¡¨ (C3-C4)</b><small>ä½éŸ³ Do è‡³ Middle C</small>
        </button>
    </div>

    <div class="header">ğŸ¼ <span id="sec-title"></span> ğŸ¼</div>
    <div class="score-board">é¡Œç›®: <span id="cur-idx">0</span> / <span id="total-q">0</span> | æ­£ç¢º: <span id="score">0</span></div>
    <div class="progress-bar"><div id="progress"></div></div>
    
    <div id="game-ui">
        <div class="question-box" id="q-content"></div>
        <div class="options-grid" id="options"></div>
        <div id="feedback"></div>
    </div>
</div>

<script>
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playTone(freq, type, duration, volume = 0.1) {
        const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
        osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(volume, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + duration);
    }
    const soundCorrect = () => { playTone(523, 'sine', 0.3); setTimeout(() => playTone(659, 'sine', 0.5), 100); };
    const soundWrong = () => playTone(220, 'sawtooth', 0.5, 0.05);

    const qBank = [
        // --- SECTION 1: 24é¡Œå®Œæ•´é¡Œåº« ---
        { s:1, q:"éŸ³ç¬¦æ˜¯ç”¨ä¾†è¨˜éŒ„éŸ³æ¨‚çš„ä»€éº¼ç¬¦è™Ÿï¼Ÿ", opts:["éŸ³æ¨‚ç¬¦è™Ÿ","æ–‡å­—ç¬¦è™Ÿ","æ•¸å­¸ç¬¦è™Ÿ","æ•¸å­—ç¬¦è™Ÿ"], a:"éŸ³æ¨‚ç¬¦è™Ÿ" },
        { s:1, q:"ä¸åŒçš„éŸ³ç¬¦ä»£è¡¨è²éŸ³ä¸åŒçš„é«˜åº¦å’Œï¼Ÿ", opts:["é•·åº¦","é‡é‡","éŸ³é‡","å¯¬åº¦"], a:"é•·åº¦" },
        { s:1, type:"note", n:"ğ…", q:"é€™å€‹éŸ³ç¬¦çš„åç¨±æ˜¯ï¼Ÿ", opts:["å…¨éŸ³ç¬¦","äºŒåˆ†éŸ³ç¬¦","å››åˆ†éŸ³ç¬¦","å…«åˆ†éŸ³ç¬¦"], a:"å…¨éŸ³ç¬¦" },
        { s:1, type:"note", n:"ğ…", q:"é€™å€‹éŸ³ç¬¦çš„åç¨±æ˜¯ï¼Ÿ", opts:["äºŒåˆ†éŸ³ç¬¦","å…¨éŸ³ç¬¦","å››åˆ†éŸ³ç¬¦","å…«åˆ†éŸ³ç¬¦"], a:"äºŒåˆ†éŸ³ç¬¦" },
        { s:1, type:"note", n:"ğ…Ÿ", q:"é€™å€‹éŸ³ç¬¦çš„åç¨±æ˜¯ï¼Ÿ", opts:["å››åˆ†éŸ³ç¬¦","äºŒåˆ†éŸ³ç¬¦","å…«åˆ†éŸ³ç¬¦","åå…­åˆ†éŸ³ç¬¦"], a:"å››åˆ†éŸ³ç¬¦" },
        { s:1, type:"note", n:"ğ… ", q:"é€™å€‹éŸ³ç¬¦çš„åç¨±æ˜¯ï¼Ÿ", opts:["å…«åˆ†éŸ³ç¬¦","åå…­åˆ†éŸ³ç¬¦","å››åˆ†éŸ³ç¬¦","å…¨éŸ³ç¬¦"], a:"å…«åˆ†éŸ³ç¬¦" },
        { s:1, type:"note", n:"ğ…¡", q:"é€™å€‹éŸ³ç¬¦çš„åç¨±æ˜¯ï¼Ÿ", opts:["åå…­åˆ†éŸ³ç¬¦","å…«åˆ†éŸ³ç¬¦","å››åˆ†éŸ³ç¬¦","äºŒåˆ†éŸ³ç¬¦"], a:"åå…­åˆ†éŸ³ç¬¦" },
        { s:1, q:"å…¨éŸ³ç¬¦ (ğ…) ä»£è¡¨å¤šå°‘æ‹ï¼Ÿ", opts:["4æ‹","2æ‹","1æ‹","3æ‹"], a:"4æ‹" },
        { s:1, q:"äºŒåˆ†éŸ³ç¬¦ (ğ…) ä»£è¡¨å¤šå°‘æ‹ï¼Ÿ", opts:["2æ‹","4æ‹","1æ‹","åŠæ‹"], a:"2æ‹" },
        { s:1, q:"å››åˆ†éŸ³ç¬¦ (ğ…Ÿ) ä»£è¡¨å¤šå°‘æ‹ï¼Ÿ", opts:["1æ‹","2æ‹","åŠæ‹","4æ‹"], a:"1æ‹" },
        { s:1, q:"å…«åˆ†éŸ³ç¬¦ (ğ… ) ä»£è¡¨å¤šå°‘æ‹ï¼Ÿ", opts:["åŠæ‹","1æ‹","1/4æ‹","2æ‹"], a:"åŠæ‹" },
        { s:1, q:"åå…­åˆ†éŸ³ç¬¦ (ğ…¡) ä»£è¡¨å¤šå°‘æ‹ï¼Ÿ", opts:["1/4æ‹","åŠæ‹","1æ‹","1/8æ‹"], a:"1/4æ‹" },
        { s:1, q:"å…¨éŸ³ç¬¦ (ğ…) çš„ Kodaly è®€éŸ³æ˜¯ï¼Ÿ", opts:["T00-00-00-00","T00-00","Ta","Ti-ti"], a:"T00-00-00-00" },
        { s:1, q:"äºŒåˆ†éŸ³ç¬¦ (ğ…) çš„ Kodaly è®€éŸ³æ˜¯ï¼Ÿ", opts:["T00-00","T00-00-00-00","Ta","Ti-ti"], a:"T00-00" },
        { s:1, q:"å››åˆ†éŸ³ç¬¦ (ğ…Ÿ) çš„ Kodaly è®€éŸ³æ˜¯ï¼Ÿ", opts:["Ta","Ti-ti","Tum","Tim"], a:"Ta" },
        { s:1, q:"å…©å€‹å…«åˆ†éŸ³ç¬¦ (ğ… ğ… ) çš„ Kodaly è®€éŸ³ï¼Ÿ", opts:["Ti-ti","Ti-ka-ti-ka","Ta","Too"], a:"Ti-ti" },
        { s:1, q:"åå…­åˆ†éŸ³ç¬¦ (ğ…¡ğ…¡ğ…¡ğ…¡) çš„ Kodaly è®€éŸ³ï¼Ÿ", opts:["Ti-ka-ti-ka","Ti-ti","Ta","Tum"], a:"Ti-ka-ti-ka" },
        { s:1, q:"é™„é»éŸ³ç¬¦é‚£ã€Œä¸€é»ã€çš„é•·åº¦æ˜¯åŸæœ¬éŸ³ç¬¦çš„ï¼Ÿ", opts:["ä¸€åŠ","ä¸€å€","å…©å€","ä¸‰å€"], a:"ä¸€åŠ" },
        { s:1, q:"é™„é»äºŒåˆ†éŸ³ç¬¦ (ğ….) æœ‰å¹¾æ‹ï¼Ÿ", opts:["3æ‹","2æ‹","4æ‹","1.5æ‹"], a:"3æ‹", mathSym:"ğ…." },
        { s:1, q:"é™„é»å››åˆ†éŸ³ç¬¦ (ğ…Ÿ.) çš„ Kodaly è®€éŸ³ï¼Ÿ", opts:["Tum","Tim","Ta","Ti-ti"], a:"Tum", mathSym:"ğ…Ÿ." },
        { s:1, q:"é™„é»å…«åˆ†éŸ³ç¬¦ (ğ… .) çš„æ‹æ•¸æ˜¯ï¼Ÿ", opts:["3/4æ‹","åŠæ‹","1æ‹","1/4æ‹"], a:"3/4æ‹", mathSym:"ğ… ." },
        { s:1, q:"é€£çµç·šé€£çµå…©å€‹éŸ³é«˜ç›¸åŒçš„éŸ³ç¬¦ï¼Œæ™‚å€¼è¦ï¼Ÿ", opts:["åŠ åœ¨ä¸€èµ·","ç›¸æ¸›","é™¤ä»¥äºŒ","ä¸è®Š"], a:"åŠ åœ¨ä¸€èµ·" },
        { s:1, q:"é€£çµç·šæ‡‰è©²ç•«åœ¨éŸ³ç¬¦çš„ï¼Ÿ", opts:["ç¬¦é ­ä¸€ç«¯","ç¬¦å¹¹ä¸€ç«¯","ä¸­é–“ä¸€ç«¯","å°¾å·´ä¸€ç«¯"], a:"ç¬¦é ­ä¸€ç«¯" },
        { s:1, q:"è¨ˆç®—ï¼šğ… â€ ğ…Ÿ (äºŒåˆ†é€£å››åˆ†) ç­‰æ–¼å¹¾æ‹ï¼Ÿ", opts:["3æ‹","2æ‹","4æ‹","5æ‹"], a:"3æ‹", mathSym:"ğ… â€ ğ…Ÿ" },

        // --- SECTION 2: é«˜éŸ³åŸºæœ¬ (C4-G4) ---
        { s:2, clef:"treble", type:"staff", q:"é€™æ˜¯ä»€éº¼éŸ³ï¼Ÿ (ä¸‹åŠ ä¸€ç·š)", y:120, ledger:true, opts:["C (Do)","D (Re)","E (Mi)","B (Ti)"], a:"C (Do)" },
        { s:2, clef:"treble", type:"staff", q:"é€™æ˜¯ä»€éº¼éŸ³ï¼Ÿ (ç¬¬ä¸€æ¢ç·šä¸‹æ–¹)", y:110, opts:["D (Re)","C (Do)","E (Mi)","F (Fa)"], a:"D (Re)" },
        { s:2, clef:"treble", type:"staff", q:"ç¬¬ä¸€æ¢ç·šä¸Šçš„éŸ³æ˜¯ï¼Ÿ", y:100, opts:["E (Mi)","F (Fa)","G (Sol)","D (Re)"], a:"E (Mi)" },
        { s:2, clef:"treble", type:"staff", q:"ç¬¬ä¸€é–“è£¡çš„éŸ³æ˜¯ï¼Ÿ", y:90, opts:["F (Fa)","G (Sol)","E (Mi)","D (Re)"], a:"F (Fa)" },
        { s:2, clef:"treble", type:"staff", q:"é€™æ˜¯ä»€éº¼éŸ³ï¼Ÿ (ç¬¬äºŒæ¢ç·š)", y:80, opts:["G (Sol)","F (Fa)","E (Mi)","A (La)"], a:"G (Sol)" },

        // --- SECTION 3: é«˜éŸ³æ“´å±• (C4-C5) ---
        { s:3, clef:"treble", type:"staff", q:"ç¬¬äºŒé–“è£¡çš„éŸ³æ˜¯ï¼Ÿ", y:70, opts:["A (La)","B (Ti)","C (é«˜éŸ³ Do)","G (Sol)"], a:"A (La)" },
        { s:3, clef:"treble", type:"staff", q:"ç¬¬ä¸‰æ¢ç·šä¸Šçš„éŸ³æ˜¯ï¼Ÿ", y:60, opts:["B (Ti)","A (La)","C (é«˜éŸ³ Do)","D (é«˜éŸ³ Re)"], a:"B (Ti)" },
        { s:3, clef:"treble", type:"staff", q:"ç¬¬ä¸‰é–“è£¡çš„éŸ³æ˜¯ï¼Ÿ", y:50, opts:["C (é«˜éŸ³ Do)","B (Ti)","D (é«˜éŸ³ Re)","A (La)"], a:"C (é«˜éŸ³ Do)" },

        // --- SECTION 4: ä½éŸ³è€ƒè©¦ (F3-C4) ---
        { s:4, clef:"bass", type:"staff", q:"ä½éŸ³è­œä¸Šæ–¹çš„åŠ ç·šéŸ³æ˜¯ï¼Ÿ", y:0, ledger:true, opts:["Middle C","B (Ti)","A (La)","G (Sol)"], a:"Middle C" },
        { s:4, clef:"bass", type:"staff", q:"ä½éŸ³è­œä¸ŠåŠ ä¸€é–“æ˜¯ï¼Ÿ", y:10, opts:["B (Ti)","A (La)","Middle C","G (Sol)"], a:"B (Ti)" },
        { s:4, clef:"bass", type:"staff", q:"ä½éŸ³è­œç¬¬äº”æ¢ç·šä¸Šçš„éŸ³æ˜¯ï¼Ÿ", y:20, opts:["A (La)","G (Sol)","F (Fa)","E (Mi)"], a:"A (La)" },
        { s:4, clef:"bass", type:"staff", q:"ä½éŸ³è­œç¬¬å››é–“è£¡çš„éŸ³æ˜¯ï¼Ÿ", y:30, opts:["G (Sol)","F (Fa)","A (La)","E (Mi)"], a:"G (Sol)" },
        { s:4, clef:"bass", type:"staff", q:"ä½éŸ³è­œç¬¬å››æ¢ç·šä¸Šçš„éŸ³æ˜¯ï¼Ÿ (è­œè™Ÿå…©é»ä¸­é–“)", y:40, opts:["F (Fa)","G (Sol)","E (Mi)","D (Re)"], a:"F (Fa)" },

        // --- SECTION 5: ä½éŸ³å…¨åŸŸ (C3-C4) ---
        { s:5, clef:"bass", type:"staff", q:"ä½éŸ³è­œç¬¬ä¸‰é–“è£¡çš„éŸ³æ˜¯ï¼Ÿ", y:50, opts:["E (Mi)","D (Re)","F (Fa)","G (Sol)"], a:"E (Mi)" },
        { s:5, clef:"bass", type:"staff", q:"ä½éŸ³è­œç¬¬ä¸‰æ¢ç·šä¸Šçš„éŸ³æ˜¯ï¼Ÿ", y:60, opts:["D (Re)","C (ä½éŸ³ Do)","E (Mi)","F (Fa)"], a:"D (Re)" },
        { s:5, clef:"bass", type:"staff", q:"ä½éŸ³è­œç¬¬äºŒé–“è£¡çš„éŸ³æ˜¯ï¼Ÿ", y:70, opts:["C (ä½éŸ³ Do)","D (Re)","B (ä½éŸ³ Ti)","A (ä½éŸ³ La)"], a:"C (ä½éŸ³ Do)" }
    ];

    let activeQs = []; let curIdx = 0; let score = 0;

    function startSection(n) {
        audioCtx.resume();
        const titles = ["", "éŸ³ç¬¦èˆ‡ç¯€å¥é‚è¼¯", "é«˜éŸ³åŸºæœ¬ (C4-G4)", "é«˜éŸ³æ“´å±• (C4-C5)", "ä½éŸ³è€ƒè©¦ (F3-C4)", "ä½éŸ³å…¨åŸŸ (C3-C4)"];
        document.getElementById('sec-title').innerText = titles[n];
        activeQs = shuffle(qBank.filter(q => q.s === n || (n === 3 && q.s === 2) || (n === 5 && (q.s === 4 || q.s === 5))));
        curIdx = 0; score = 0;
        document.getElementById('total-q').innerText = activeQs.length;
        document.getElementById('menu-overlay').style.display = 'none';
        render();
    }

    function shuffle(a) { for (let i=a.length-1; i>0; i--) { const j=Math.floor(Math.random()*(i+1)); [a[i], a[j]]=[a[j], a[i]]; } return a; }

    function render() {
        const q = activeQs[curIdx];
        const box = document.getElementById('q-content');
        const optsDiv = document.getElementById('options');
        document.getElementById('cur-idx').innerText = curIdx + 1;
        document.getElementById('progress').style.width = `${(curIdx/activeQs.length)*100}%`;
        document.getElementById('feedback').innerText = ""; optsDiv.innerHTML = "";

        let html = `<p style="font-size:18px; font-weight:bold;">${q.q}</p>`;
        if (q.type === "staff") {
            const isT = q.clef === "treble";
            html += `<div class="staff-container">
                <div class="clef ${isT?'treble-clef':'bass-clef'}">${isT?'ğ„':'ğ„¢'}</div>
                <div class="staff-line line5"></div><div class="staff-line line4"></div>
                <div class="staff-line line3"></div><div class="staff-line line2"></div>
                <div class="staff-line line1"></div>`;
            if(q.ledger) html += `<div class="ledger-line" style="top:${q.y}px"></div>`;
            html += `<div class="staff-note" style="top:${q.y-10}px"></div></div>`;
        } else if (q.type === "note") {
            html += `<div class="note-display">${q.n}</div>`;
        } else if (q.mathSym) {
            html += `<div class="math-symbol-box">${q.mathSym}</div>`;
        } else {
            html += `<div style="font-size:50px; margin:20px;"></div>`;
        }
        box.innerHTML = html;

        shuffle([...q.opts]).forEach(o => {
            const b = document.createElement('button'); b.innerText = o;
            b.onclick = () => {
                document.querySelectorAll('button').forEach(btn=>btn.disabled=true);
                if(o === q.a){ score++; soundCorrect(); document.getElementById('feedback').innerHTML="<span style='color:var(--success)'>âœ”ï¸ æ­£ç¢ºï¼</span>"; }
                else { soundWrong(); document.getElementById('feedback').innerHTML=`<span style='color:var(--error)'>âŒ ç­”æ¡ˆæ˜¯ï¼š${q.a}</span>`; }
                document.getElementById('score').innerText = score;
                setTimeout(()=>{ curIdx++; if(curIdx<activeQs.length) render(); else finish(); }, 1500);
            };
            optsDiv.appendChild(b);
        });
    }

    function finish() {
        document.getElementById('progress').style.width = "100%";
        document.getElementById('q-content').innerHTML = `<h2>ğŸ‰ å®ŒæˆæŒ‘æˆ°ï¼</h2><p>æœ€çµ‚å¾—åˆ†: ${score} / ${activeQs.length}</p>`;
        document.getElementById('options').innerHTML = `<button style="grid-column:1/3; background:var(--primary)" onclick="location.reload()">è¿”å›ä¸»é¸å–®</button>`;
    }
</script>
</body>
</html>